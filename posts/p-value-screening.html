<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kenneth Hung">
<meta name="dcterms.date" content="2018-09-21">
<meta name="description" content="Better multiple testing by screening p-values first, to reduce the penalty in common multiple testing procedure">

<title>Kenneth Hung - p-value screening</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Kenneth Hung</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching.html">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../posts.html">
 <span class="menu-text">Posts</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">p-value screening</h1>
  <div class="quarto-categories">
    <div class="quarto-category">multiple testing</div>
    <div class="quarto-category">selective inference</div>
  </div>
  </div>

<div>
  <div class="description">
    Better multiple testing by screening p-values first, to reduce the penalty in common multiple testing procedure
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kenneth Hung </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 21, 2018</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Will and I have been working on a problem for finding confidence lower bounds for maximum parameter. Here is a good toy model: the confidence lower bound for the maximum mean parameter for an i.i.d. Gaussian observation. Specifically, we are trying to find a confidence bound for <span class="math inline">\(\max_i \mu_i\)</span> from the observations <span class="math inline">\(X \sim N(\mu, I_n)\)</span> where <span class="math inline">\(\mu\)</span> is the mean vector from <span class="math inline">\(\mathbb{R}^n\)</span>.</p>
<p>Now a good lower confidence bound would one that is larger. We can consider the test dual to the confidence bound: a test with higher power generally should mean a better confidence bound. The dual test will test the null hypothesis</p>
<p><span class="math display">\[H_0^\tau: \max_i \mu_i \le \tau,\]</span></p>
<p>which is really just the intersection of <span class="math inline">\(H_{0, i}^\tau: \mu_i \le \tau\)</span>. We are now in the realm of multiple testing!</p>
<p>A basic idea to test <span class="math inline">\(H_0^\tau\)</span> is of course through Bonferroni correction. However, as we test <span class="math inline">\(H_0^\tau\)</span> for <span class="math inline">\(\tau\)</span> that is larger than many of the observations <span class="math inline">\(X_i\)</span>’s, few of these observations will provide evidence against the null but they count towards the multiplicity nonetheless. This is where we can aim to do better.</p>
<p><span class="citation" data-cites="zhao2018multiple">Zhao et al. (<a href="#ref-zhao2018multiple" role="doc-biblioref">2018</a>)</span> suggested to use a <span class="math inline">\(\lambda\)</span> to screen out the <em>p</em>-values under <span class="math inline">\(\lambda\)</span>, divide the remaining <em>p</em>-values by <span class="math inline">\(\lambda\)</span>. (This idea was also rediscovered by <span class="citation" data-cites="ellis2020gaining">Ellis et al. (<a href="#ref-ellis2020gaining" role="doc-biblioref">2020</a>)</span>.) We have also rediscovered the same idea, and all three groups stated very similar conditions for the <em>p</em>-values, from “uniformly conservative” to “supreuniform”. This <span class="math inline">\(\lambda\)</span> can also be taken as a stopping time: <span class="math inline">\(\lambda\)</span> can go from 0 to 1, revealing any <em>p</em>-value greater than <span class="math inline">\(\lambda\)</span> and stopping based only on this information. It can be shown that this still controls the type I error rate, through a martingale argument not unlike the proof of Benjamini–Hochberg procedure.</p>
<p>But Zhao, Small and Su (2018) took an extra step in proposing a beautiful method for selecting this <span class="math inline">\(\lambda\)</span>: Note that the “saving” ones gets from performing the <em>p</em>-value screening is</p>
<p><span class="math display">\[\frac{F(\lambda)}{\lambda},\]</span></p>
<p>where <span class="math inline">\(F(\lambda)\)</span> is the averaged distribution of the <em>p</em>-values. The smaller the ratio above, the better the test will perform. Taking the derivatives give</p>
<p><span class="math display">\[\frac{d}{\lambda} \frac{F(\lambda)}{\lambda} = \frac{F'(\lambda) \lambda - F(\lambda)}{\lambda^2},\]</span></p>
<p>and a good choice of stopping is when there is no strong evidence that <span class="math inline">\(F'(\lambda) \lambda - F(\lambda) &gt; 0\)</span>. In general this should eventually happen, either when <span class="math inline">\(\lambda\)</span> gets uncomfortably close to 0, or when most of the true nulls have been removed.</p>
<p>This approach is great for testing, but comes with two caveats when it comes to finding lower confidence bounds: - We do not know if this test is monotone: it is possible that the test rejects at <span class="math inline">\(\tau\)</span> yet accepts at some <span class="math inline">\(\tau' &lt; \tau\)</span>. This may happen if the multiplicity correction is substantially greater for testing <span class="math inline">\(H_0^{\tau'}\)</span> than at <span class="math inline">\(H_0^{\tau}\)</span>. - If we are not using the Zhao, Small and Su (2018) method for picking <span class="math inline">\(\lambda\)</span> and leaving this to an analyst’s discretion, the analyst may not be principled enough. They may be using a <span class="math inline">\(\lambda\)</span>, while wishing that they have used stopped earlier.</p>
<p>The later point raises a question, similar to that in <span class="citation" data-cites="johari2019always">Johari et al. (<a href="#ref-johari2019always" role="doc-biblioref">2019</a>)</span> or “spotting time” as suggested by Aaditya Ramdas: Is it possible to allow an analyst stop anytime they want? If so, allowing an analyst to go backwards should come with a price. How do we make an appropriate correction?</p>
<p>Choosing a screening threshold at <span class="math inline">\(\lambda\)</span> is essentially the same as using</p>
<p><span class="math display">\[n p_{(1)} \frac{F_n(\lambda)}{\lambda}\]</span></p>
<p>as the test statistic and reject for small values. Here <span class="math inline">\(p_{(1)}\)</span> is the smallest <em>p</em>-value and <span class="math inline">\(F_n\)</span> is the empirical CDF of the <em>p</em>-values. What we want to do is essentially using the test statistic</p>
<p><span class="math display">\[n p_{(1)} \min_{\lambda \in \Lambda_0} \frac{F_n(\lambda)}{\lambda}\]</span></p>
<p>for some subset <span class="math inline">\(\Lambda_0 \subset (0, 1]\)</span>, and rejecting for small values. This is equivalent to allow an analyst to search through <span class="math inline">\(\Lambda_0\)</span> to cherry pick the best looking <span class="math inline">\(\lambda\)</span>. Some possible options of <span class="math inline">\(\Lambda_0\)</span> are <span class="math inline">\([\lambda_0, 1]\)</span> for some prespecified <span class="math inline">\(\lambda_0\)</span> or <span class="math inline">\(\Lambda_0 = [p_{(k)}, 1]\)</span> where <span class="math inline">\(p_{(k)}\)</span> is the <span class="math inline">\(k\)</span>-th smallest <em>p</em>-value.</p>
<p>The first one, while maybe more practical, is less interesting as it probably is not <em>too</em> different from using a fixed <span class="math inline">\(\lambda_0\)</span>. We will turn to the second option here. We will analyse it by finding a “stochastic lower bound” for this statistic. We have</p>
<p><span class="math display">\[\begin{eqnarray}
n p_{(1)} \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda)}{\lambda} &amp;=&amp; n p_{(1)} \min_{\lambda \ge p_{(k)}} \frac{F(\lambda)}{\lambda} \frac{F_n(\lambda)}{F(\lambda)} \\
&amp;\stackrel{\text{st}}{\ge}&amp; n p_{(1)} \min_{\lambda \ge p_{(k)}} \frac{F(\lambda)}{\lambda} \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda)}{F(\lambda)} \\
&amp;=&amp; n p_{(1)} \frac{F(p_{(1)})}{p_{(1)}} \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda)}{F(\lambda)} \\
&amp;=&amp; n F(p_{(1)}) \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda)}{F(\lambda)}.
\end{eqnarray}\]</span></p>
<p>Of course, <span class="math inline">\(n F(p_{(1)})\)</span> is stochastically larger than <span class="math inline">\(U[0, 1]\)</span>. So it suffices to control <span class="math inline">\(\min_{\lambda \ge p_{(k)}} F_n(\lambda) / F(\lambda)\)</span>, or equivalently, make sure <span class="math inline">\(\max_{\lambda \ge p_{(k)}} F(\lambda) / F_n(\lambda)\)</span> is not too big. We consider the least favorable distribution, where all <em>p</em>-values are uniformly distributed, i.e.&nbsp;<span class="math inline">\(F(p) = p\)</span>.</p>
<p>This quantity of interest may look like something from empirical process, but we can focus on its value at one of the <em>p</em>-values. So it is good enough to look at</p>
<p><span class="math display">\[F(p_{(t)}) / F_n(p_{(t)}) = n p_{(t)} / t,\]</span></p>
<p>which happens to be a martingale under the filtration <span class="math inline">\(\mathcal{F}_t = \sigma(\{p_{(t)}, \ldots, p_{(n)}\})\)</span> as <span class="math inline">\(t\)</span> decreases from <span class="math inline">\(n\)</span> to <span class="math inline">\(k\)</span>. The expectation of each term in <span class="math inline">\(n / (n+1)\)</span>, so we can use Doob’s martingale inequality on the submartingale</p>
<p><span class="math display">\[\left(\frac{p_{(t)}}{t} - \frac{n}{n+1}\right)^2\]</span></p>
<p>to get some concentration, giving</p>
<p><span class="math display">\[\begin{eqnarray}
\mathbb{P}\left[\max_{k \le t \le n} \left(\frac{n p_{(t)}}{t} - \frac{n}{n+1}\right)^2 &gt; C\right] &amp;\le&amp; \frac{\mathrm{var}[n p_{(k)} / k]}{C} \\
&amp;=&amp; \frac{1}{C} \cdot \frac{n^2 (n+1-k)}{k (n+1)^2 (n+2)}.
\end{eqnarray}\]</span></p>
<p>There probably is a better bound, but for now let’s stick with this. Under the null we have</p>
<p><span class="math display">\[\begin{eqnarray}
\mathbb{P}\left[\min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda) + \frac{1}{n}}{\lambda} &lt; \frac{1}{C}\right] &amp;\le&amp; \mathbb{P}\left[\max_{k \le t \le n} \frac{p_{(k)}}{k} &lt; C\right] \\
&amp;\le&amp; \frac{1}{\left(C - \frac{n}{n+1}\right)^2} \cdot \frac{n^2 (n+1-k)}{k (n+1)^2 (n+2)}
\end{eqnarray}\]</span></p>
<p>for any <span class="math inline">\(C &gt; \frac{n+1}{n}\)</span>. With this bound, we have that</p>
<p><span class="math display">\[C n p_{(1)} \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda) + \frac{1}{n}}{\lambda} + \frac{1}{\left(C - \frac{n}{n+1}\right)^2} \cdot \frac{n^2 (n+1-k)}{C k (n+1)^2 (n+2)}\]</span></p>
<p>is stochastically larger than <span class="math inline">\(U[0, 1]\)</span> for any <span class="math inline">\(C &gt; \frac{n}{n+1}\)</span>. Optimizing over <span class="math inline">\(C\)</span> gives that</p>
<p><span class="math display">\[\frac{n^2}{n+1} p_{(1)} \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda) + \frac{1}{n}}{\lambda} + \frac{3}{2^{2/3}} \left(np_{(1)} \min_{\lambda \ge p_{(k)}} \frac{F_n(\lambda) + \frac{1}{n}}{\lambda}\right)^{2/3} \left(\frac{n^2 (n+1-k)}{k (n+1)^2 (n+2)}\right)^{1/3}\]</span></p>
<p>is also stochastically larger than <span class="math inline">\(U[0, 1]\)</span>, so we can use this as our <em>p</em>-value.</p>
<p>In a pessimistic case where the analyst shows no restraint, there is nevertheless no reason to choose <span class="math inline">\(\lambda \le p_{(2)}\)</span>, so the smallest <span class="math inline">\(k\)</span> is 2. Now the question comes: how does this test fare compared to Zhao, Small, Su (2018)?</p>
<p>We wrote a short piece of code to test this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(foreach))</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>spotting.test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">k =</span> <span class="dv">2</span>) {</span>
<span id="cb1-4"><a href="#cb1-4"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  p <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">pnorm</span>(x, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))</span>
<span id="cb1-6"><a href="#cb1-6"></a>  multiplier <span class="ot">&lt;-</span> <span class="fu">min</span>((k<span class="sc">:</span>n) <span class="sc">/</span> p[k<span class="sc">:</span>n] <span class="sc">/</span> n)</span>
<span id="cb1-7"><a href="#cb1-7"></a>  comb.p <span class="ot">&lt;-</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>    n<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (n <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> p[<span class="dv">1</span>] <span class="sc">*</span> multiplier <span class="sc">+</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>    <span class="dv">3</span> <span class="sc">/</span> <span class="dv">2</span><span class="sc">^</span>(<span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">*</span> (n <span class="sc">*</span> p[<span class="dv">1</span>] <span class="sc">*</span> multiplier)<span class="sc">^</span>(<span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">*</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>    (n<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (n <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> k) <span class="sc">/</span> k <span class="sc">/</span> (n <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (n <span class="sc">+</span> <span class="dv">2</span>))<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">min</span>(comb.p, <span class="dv">1</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a>}</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>spotting.power <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, <span class="at">k =</span> <span class="dv">2</span>) {</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="fu">require</span>(foreach)</span>
<span id="cb1-16"><a href="#cb1-16"></a>  rej <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="at">.combine =</span> <span class="st">"c"</span>) <span class="sc">%do%</span> {</span>
<span id="cb1-17"><a href="#cb1-17"></a>    x <span class="ot">&lt;-</span> mu <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(mu))</span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="fu">spotting.test</span>(x, k) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>  }</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="fu">mean</span>(rej)</span>
<span id="cb1-21"><a href="#cb1-21"></a>}</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="fu">c</span>(</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="fu">spotting.power</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">100</span>)),</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">99</span>))),</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">99</span>))),</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">99</span>))),</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">99</span>))),</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">80</span>))),</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">80</span>))),</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="fu">spotting.power</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">80</span>)))</span>
<span id="cb1-32"><a href="#cb1-32"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0076 0.5725 0.7113 0.8851 0.8873 0.0440 0.0621 0.1157</code></pre>
</div>
</div>
<p>Since post condition we are really just using Bonferroni test, we will compare to those particular rows in Table 2 in Zhao, Small, Su (2018):</p>
<table class="table">
<colgroup>
<col style="width: 53%">
<col style="width: 21%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Setting</th>
<th style="text-align: right;"><span class="math inline">\(\tau\)</span> = 0.5</th>
<th style="text-align: right;">Adaptive</th>
<th style="text-align: right;">Spotting</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1. All null</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">0.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2. 1 strong 99 null</td>
<td style="text-align: right;">76.6</td>
<td style="text-align: right;">76.7</td>
<td style="text-align: right;">57.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3. 1 strong 99 conservative</td>
<td style="text-align: right;">85.2</td>
<td style="text-align: right;">84.0</td>
<td style="text-align: right;">70.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">4. 1 strong 99 very conservative</td>
<td style="text-align: right;">98.0</td>
<td style="text-align: right;">98.7</td>
<td style="text-align: right;">88.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5. 1 strong 99 extremely conservative</td>
<td style="text-align: right;">97.8</td>
<td style="text-align: right;">98.9</td>
<td style="text-align: right;">89.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">6. 20 weak 80 null</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">22.5</td>
<td style="text-align: right;">4.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7. 20 weak 80 conservative</td>
<td style="text-align: right;">28.1</td>
<td style="text-align: right;">26.3</td>
<td style="text-align: right;">6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">8. 20 weak 80 very conservative</td>
<td style="text-align: right;">38.1</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: right;">11.6</td>
</tr>
</tbody>
</table>
<p>Welp. This does not work that well. One possible reason is that “Adaptive” does a good job capturing the best cutoff already, spotting needs to account for too much noise and pays an unnecessarily high price. In either case, it is not clear if the spotting test is monotone anyway.</p>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-ellis2020gaining" class="csl-entry" role="doc-biblioentry">
Ellis, J. L., Pecanka, J., and Goeman, J. J. (2020), <span>“Gaining power in multiple testing of interval hypotheses via conditionalization,”</span> <em>Biostatistics</em>, 21, e65–e79.
</div>
<div id="ref-johari2019always" class="csl-entry" role="doc-biblioentry">
Johari, R., Pekelis, L., and Walsh, D. J. (2019), <span>“Always <span>Valid Inference</span>: <span>Bringing Sequential Analysis</span> to <span>A</span>/<span>B Testing</span>,”</span> <span>arXiv</span>. <a href="https://doi.org/10.48550/arXiv.1512.04922">https://doi.org/10.48550/arXiv.1512.04922</a>.
</div>
<div id="ref-zhao2018multiple" class="csl-entry" role="doc-biblioentry">
Zhao, Q., Small, D. S., and Su, W. J. (2018), <span>“Multiple testing when many p-values are uniformly conservative, with application to testing qualitative interaction in educational interventions,”</span> <em>Journal of the American Statistical Association</em>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:me@kenhung.me">
      <i class="bi bi-envelope-fill" role="img" aria-label="email: me@kenhung.me">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kenhungkk">
      <i class="bi bi-github" role="img" aria-label="github: kenhungkk">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=G0x9hZkAAAAJ&amp;hl=en">
      <i class="bi bi-mortarboard-fill" role="img" aria-label="google scholar">
</i> 
    </a>
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>